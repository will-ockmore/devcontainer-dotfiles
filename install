#!/usr/bin/env python3

from pathlib import Path
from urllib.request import urlopen
import subprocess
import sys
import shutil

"""
TODO: Install:
    - ripgrep
    - fzf
    - bat
    - exa
    - neovim
    - pure prompt
    
TODO: Copy over:
    - .zshrc
    - aliases
    - init.vim and coc-settings.json
"""

ADDITIONAL_PROGRAMS = ["ripgrep", "fzf", "bat", "neovim", "exa"]

RED = "\x1b[31;20m"
BOLD_CYAN = "\x1b[36;1m"
BOLD_WHITE = "\x1b[37;1m"
RESET = "\x1b[0m"


def copy_dotfiles():
    print(f"{BOLD_WHITE}Moving configuration files...{RESET}")
    print()

    dotfiles_dir = Path(__file__).parent

    for entry in [".dotfiles", ".zshrc"]:
        shutil.copytree(dotfiles_dir / entry, Path.home() / entry)


def install_programs():
    print(f"{BOLD_WHITE}Installing additional programs...{RESET}")
    print()

    # Fetch latest package lists
    subprocess.run(["apt", "update"], check=True)

    subprocess.run(["apt", "install", "-y", *ADDITIONAL_PROGRAMS], check=True)

    # Install pure prompt
    (Path.home() / ".zsh").mkdir(parents=True, exist_ok=True)
    subprocess.run(
        [
            "git",
            "clone",
            "https://github.com/sindresorhus/pure.git",
            str(Path.home() / ".zsh/pure"),
        ],
        check=True,
    )


def main():
    print()
    print(f"Running {BOLD_CYAN}dotfiles install script{RESET} ðŸ’¿")
    print()

    copy_dotfiles()
    install_programs()


if __name__ == "__main__":
    main()
